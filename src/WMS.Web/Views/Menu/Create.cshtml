@model WMS.Application.DTOs.MenuDto
@{
    ViewData["Title"] = "æ–°å¢èœå•";
}

<div class="page-container">
    <div class="page-header-section">
        <div class="page-title-wrapper">
            <h2 class="page-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px; vertical-align: middle;">
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                </svg>
                æ–°å¢èœå•
            </h2>
            <p class="page-subtitle">åˆ›å»ºæ–°çš„ç³»ç»Ÿèœå•å’ŒæŒ‰é’®</p>
        </div>
    </div>

    <div class="card-modern">
        <div class="card-body-modern">
            @if (ViewBag.Error != null)
            {
                <div class="alert-modern alert-danger-modern" role="alert">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px;">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                    </svg>
                    @ViewBag.Error
                </div>
            }

            <form asp-action="Create" method="post" class="form-modern">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label asp-for="Name" class="form-label-modern">
                                èœå•åç§° <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="form-control-modern" required placeholder="è¯·è¾“å…¥èœå•åç§°" />
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Code" class="form-label-modern">
                                èœå•ç¼–ç  <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Code" class="form-control-modern" required placeholder="è¯·è¾“å…¥èœå•ç¼–ç ï¼ˆè‹±æ–‡ï¼‰" />
                            <small class="form-text-modern">èœå•ç¼–ç ç”¨äºç³»ç»Ÿå†…éƒ¨è¯†åˆ«ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡å¤§å†™å­—æ¯</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="ParentId" class="form-label-modern">çˆ¶èœå•</label>
                            <select asp-for="ParentId" class="form-control-modern">
                                <option value="">é¡¶çº§èœå•</option>
                                @foreach (var menu in ViewBag.Menus as List<WMS.Application.DTOs.MenuDto> ?? new List<WMS.Application.DTOs.MenuDto>())
                                {
                                    <option value="@menu.Id">@menu.Name</option>
                                }
                            </select>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="MenuType" class="form-label-modern">
                                èœå•ç±»å‹ <span class="text-danger">*</span>
                            </label>
                            <select asp-for="MenuType" class="form-control-modern" required>
                                <option value="0">å†…éƒ¨é¡µé¢</option>
                                <option value="1">å¤–éƒ¨é“¾æ¥</option>
                            </select>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Path" class="form-label-modern">è·¯å¾„/é“¾æ¥</label>
                            <input asp-for="Path" class="form-control-modern" placeholder="ä¾‹å¦‚: /User/Index æˆ– https://example.com" />
                            <small class="form-text-modern">å†…éƒ¨é¡µé¢å¡«å†™è·¯ç”±è·¯å¾„ï¼Œå¤–éƒ¨é“¾æ¥å¡«å†™å®Œæ•´URL</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Icon" class="form-label-modern">å›¾æ ‡</label>
                            <input asp-for="Icon" class="form-control-modern" placeholder="ä¾‹å¦‚: ğŸ“ æˆ– fa-home" />
                            <small class="form-text-modern">å¯ä»¥ä½¿ç”¨Emojiè¡¨æƒ…æˆ–å›¾æ ‡ç±»å</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Sort" class="form-label-modern">æ’åº</label>
                            <input asp-for="Sort" type="number" class="form-control-modern" value="0" placeholder="æ•°å­—è¶Šå°è¶Šé å‰" />
                        </div>

                        <div class="form-group-modern">
                            <div class="form-check-modern">
                                <input asp-for="IsEnabled" class="form-check-input-modern" type="checkbox" checked id="isEnabled" />
                                <label asp-for="IsEnabled" class="form-check-label-modern" for="isEnabled">
                                    å¯ç”¨èœå•
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label class="form-label-modern">æŒ‰é’®è®¾ç½®</label>
                            <div id="buttonList" class="button-list-container">
                                <button type="button" class="btn-add-button" onclick="addButton()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                                    </svg>
                                    æ·»åŠ æŒ‰é’®
                                </button>
                                <div id="buttons" class="buttons-list">
                                    <!-- æŒ‰é’®åˆ—è¡¨ -->
                                </div>
                            </div>
                            <small class="form-text-modern">ä¸ºèœå•æ·»åŠ æŒ‰é’®æƒé™ï¼ŒæŒ‰é’®å°†æ˜¾ç¤ºåœ¨èœå•é¡µé¢ä¸­</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 1-1-1H7a1 1 0 0 1 1-1H2zm0 1v12h12V2H2z"/>
                            <path d="M9.5 4a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM9 5h2v2H9z"/>
                        </svg>
                        ä¿å­˜
                    </button>
                    <a href="@Url.Action("Index", "Menu")" class="btn-cancel">è¿”å›</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let buttonIndex = 0;

function addButton() {
    const buttonsDiv = document.getElementById('buttons');
    const buttonHtml = `
        <div class="button-item-card" data-index="${buttonIndex}">
            <div class="button-item-content">
                <div class="button-item-row">
                    <div class="button-item-field">
                        <input type="text" name="Buttons[${buttonIndex}].Name" class="form-control-modern form-control-sm" placeholder="æŒ‰é’®åç§°" required />
                    </div>
                    <div class="button-item-field">
                        <input type="text" name="Buttons[${buttonIndex}].Code" class="form-control-modern form-control-sm" placeholder="æŒ‰é’®ç¼–ç " required />
                    </div>
                    <div class="button-item-field">
                        <select name="Buttons[${buttonIndex}].ButtonType" class="form-control-modern form-control-sm">
                            <option value="0">æŸ¥çœ‹</option>
                            <option value="1">æ–°å¢</option>
                            <option value="2">ç¼–è¾‘</option>
                            <option value="3">åˆ é™¤</option>
                            <option value="4">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="button-item-action">
                        <button type="button" class="btn-remove-button" onclick="removeButton(${buttonIndex})" title="åˆ é™¤">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    buttonsDiv.insertAdjacentHTML('beforeend', buttonHtml);
    buttonIndex++;
}

function removeButton(index) {
    const item = document.querySelector(`.button-item-card[data-index="${index}"]`);
    if (item) {
        item.remove();
    }
}
</script>


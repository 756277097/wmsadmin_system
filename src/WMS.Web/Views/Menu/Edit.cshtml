@model WMS.Application.DTOs.MenuDto
@{
    ViewData["Title"] = "ç¼–è¾‘èœå•";
}

<div class="page-container">
    <div class="page-header-section">
        <div class="page-title-wrapper">
            <h2 class="page-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px; vertical-align: middle;">
                    <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                </svg>
                ç¼–è¾‘èœå•
            </h2>
            <p class="page-subtitle">ä¿®æ”¹èœå•ä¿¡æ¯å’ŒæŒ‰é’®é…ç½®</p>
        </div>
    </div>

    <div class="card-modern">
        <div class="card-body-modern">
            <form asp-action="Edit" method="post" class="form-modern">
                <input type="hidden" asp-for="Id" />
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label asp-for="Name" class="form-label-modern">
                                èœå•åç§° <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="form-control-modern" required placeholder="è¯·è¾“å…¥èœå•åç§°" />
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Code" class="form-label-modern">
                                èœå•ç¼–ç  <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Code" class="form-control-modern" required placeholder="è¯·è¾“å…¥èœå•ç¼–ç ï¼ˆè‹±æ–‡ï¼‰" />
                            <small class="form-text-modern">èœå•ç¼–ç ç”¨äºç³»ç»Ÿå†…éƒ¨è¯†åˆ«ï¼Œå»ºè®®ä½¿ç”¨è‹±æ–‡å¤§å†™å­—æ¯</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="ParentId" class="form-label-modern">çˆ¶èœå•</label>
                            <select asp-for="ParentId" class="form-control-modern">
                                <option value="">é¡¶çº§èœå•</option>
                                @foreach (var menu in ViewBag.Menus as List<WMS.Application.DTOs.MenuDto> ?? new List<WMS.Application.DTOs.MenuDto>())
                                {
                                    <option value="@menu.Id">@menu.Name</option>
                                }
                            </select>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="MenuType" class="form-label-modern">
                                èœå•ç±»å‹ <span class="text-danger">*</span>
                            </label>
                            <select asp-for="MenuType" class="form-control-modern" required>
                                <option value="0">å†…éƒ¨é¡µé¢</option>
                                <option value="1">å¤–éƒ¨é“¾æ¥</option>
                            </select>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Path" class="form-label-modern">è·¯å¾„/é“¾æ¥</label>
                            <input asp-for="Path" class="form-control-modern" placeholder="ä¾‹å¦‚: /User/Index æˆ– https://example.com" />
                            <small class="form-text-modern">å†…éƒ¨é¡µé¢å¡«å†™è·¯ç”±è·¯å¾„ï¼Œå¤–éƒ¨é“¾æ¥å¡«å†™å®Œæ•´URL</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Icon" class="form-label-modern">å›¾æ ‡</label>
                            <input asp-for="Icon" class="form-control-modern" placeholder="ä¾‹å¦‚: ğŸ“ æˆ– fa-home" />
                            <small class="form-text-modern">å¯ä»¥ä½¿ç”¨Emojiè¡¨æƒ…æˆ–å›¾æ ‡ç±»å</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Sort" class="form-label-modern">æ’åº</label>
                            <input asp-for="Sort" type="number" class="form-control-modern" placeholder="æ•°å­—è¶Šå°è¶Šé å‰" />
                        </div>

                        <div class="form-group-modern">
                            <div class="form-check-modern">
                                <input asp-for="IsEnabled" class="form-check-input-modern" type="checkbox" id="isEnabled" />
                                <label asp-for="IsEnabled" class="form-check-label-modern" for="isEnabled">
                                    å¯ç”¨èœå•
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label class="form-label-modern">æŒ‰é’®è®¾ç½®</label>
                            <div id="buttonList" class="button-list-container">
                                <button type="button" class="btn-add-button" onclick="addButton()">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                                    </svg>
                                    æ·»åŠ æŒ‰é’®
                                </button>
                                <div id="buttons" class="buttons-list">
                                    @for (int i = 0; i < Model.Buttons.Count; i++)
                                    {
                                        <div class="button-item-card" data-index="@i">
                                            <div class="button-item-content">
                                                <input type="hidden" name="Buttons[@i].Id" value="@Model.Buttons[i].Id" />
                                                <div class="button-item-row">
                                                    <div class="button-item-field">
                                                        <input type="text" name="Buttons[@i].Name" class="form-control-modern form-control-sm" value="@Model.Buttons[i].Name" required />
                                                    </div>
                                                    <div class="button-item-field">
                                                        <input type="text" name="Buttons[@i].Code" class="form-control-modern form-control-sm" value="@Model.Buttons[i].Code" required />
                                                    </div>
                                                    <div class="button-item-field">
                                                        <select name="Buttons[@i].ButtonType" class="form-control-modern form-control-sm">
                                                            <option value="0" selected="@(Model.Buttons[i].ButtonType == 0)">æŸ¥çœ‹</option>
                                                            <option value="1" selected="@(Model.Buttons[i].ButtonType == 1)">æ–°å¢</option>
                                                            <option value="2" selected="@(Model.Buttons[i].ButtonType == 2)">ç¼–è¾‘</option>
                                                            <option value="3" selected="@(Model.Buttons[i].ButtonType == 3)">åˆ é™¤</option>
                                                            <option value="4" selected="@(Model.Buttons[i].ButtonType == 4)">å…¶ä»–</option>
                                                        </select>
                                                    </div>
                                                    <div class="button-item-action">
                                                        <button type="button" class="btn-remove-button" onclick="removeButton(@i)" title="åˆ é™¤">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                                            </svg>
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                            <small class="form-text-modern">ä¸ºèœå•æ·»åŠ æŒ‰é’®æƒé™ï¼ŒæŒ‰é’®å°†æ˜¾ç¤ºåœ¨èœå•é¡µé¢ä¸­</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 1-1-1H7a1 1 0 0 1 1-1H2zm0 1v12h12V2H2z"/>
                            <path d="M9.5 4a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM9 5h2v2H9z"/>
                        </svg>
                        ä¿å­˜
                    </button>
                    <a href="@Url.Action("Index", "Menu")" class="btn-cancel">è¿”å›</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
let buttonIndex = @Model.Buttons.Count;

function addButton() {
    const buttonsDiv = document.getElementById('buttons');
    const buttonHtml = `
        <div class="button-item-card" data-index="${buttonIndex}">
            <div class="button-item-content">
                <div class="button-item-row">
                    <div class="button-item-field">
                        <input type="text" name="Buttons[${buttonIndex}].Name" class="form-control-modern form-control-sm" placeholder="æŒ‰é’®åç§°" required />
                    </div>
                    <div class="button-item-field">
                        <input type="text" name="Buttons[${buttonIndex}].Code" class="form-control-modern form-control-sm" placeholder="æŒ‰é’®ç¼–ç " required />
                    </div>
                    <div class="button-item-field">
                        <select name="Buttons[${buttonIndex}].ButtonType" class="form-control-modern form-control-sm">
                            <option value="0">æŸ¥çœ‹</option>
                            <option value="1">æ–°å¢</option>
                            <option value="2">ç¼–è¾‘</option>
                            <option value="3">åˆ é™¤</option>
                            <option value="4">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="button-item-action">
                        <button type="button" class="btn-remove-button" onclick="removeButton(${buttonIndex})" title="åˆ é™¤">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    buttonsDiv.insertAdjacentHTML('beforeend', buttonHtml);
    buttonIndex++;
}

function removeButton(index) {
    const item = document.querySelector(`.button-item-card[data-index="${index}"]`);
    if (item) {
        item.remove();
    }
}
</script>


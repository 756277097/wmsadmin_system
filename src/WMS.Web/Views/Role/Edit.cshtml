@model WMS.Application.DTOs.RoleDto
@{
    ViewData["Title"] = "编辑角色";
}

<div class="page-container">
    <div class="page-header-section">
        <div class="page-title-wrapper">
            <h2 class="page-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px; vertical-align: middle;">
                    <path d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.5.5 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z"/>
                </svg>
                编辑角色
            </h2>
            <p class="page-subtitle">修改角色信息和权限配置</p>
        </div>
    </div>

    <div class="card-modern">
        <div class="card-body-modern">
            <form asp-action="Edit" method="post" class="form-modern">
                <input type="hidden" asp-for="Id" />
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label asp-for="Name" class="form-label-modern">
                                角色名称 <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Name" class="form-control-modern" required placeholder="请输入角色名称" />
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Code" class="form-label-modern">
                                角色编码 <span class="text-danger">*</span>
                            </label>
                            <input asp-for="Code" class="form-control-modern" required placeholder="请输入角色编码（英文）" />
                            <small class="form-text-modern">角色编码用于系统内部识别，建议使用英文大写字母</small>
                        </div>

                        <div class="form-group-modern">
                            <label asp-for="Description" class="form-label-modern">描述</label>
                            <textarea asp-for="Description" class="form-control-modern" rows="3" placeholder="请输入角色描述"></textarea>
                        </div>

                        <div class="form-group-modern">
                            <div class="form-check-modern">
                                <input asp-for="IsEnabled" class="form-check-input-modern" type="checkbox" id="isEnabled" />
                                <label asp-for="IsEnabled" class="form-check-label-modern" for="isEnabled">
                                    启用角色
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group-modern">
                            <label class="form-label-modern">权限设置</label>
                            <div id="permissionTree" class="permission-tree-container">
                                <div class="loading-text">加载权限树...</div>
                            </div>
                            <small class="form-text-modern">选择该角色可以访问的菜单和按钮权限</small>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn-save">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 1-1-1H7a1 1 0 0 1 1-1H2zm0 1v12h12V2H2z"/>
                            <path d="M9.5 4a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM9 5h2v2H9z"/>
                        </svg>
                        保存
                    </button>
                    <a href="@Url.Action("Index", "Role")" class="btn-cancel">返回</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // 将已有权限数据注入到全局变量
        window.rolePermissions = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.Permissions));
    </script>
    <script src="~/js/role-permission.js"></script>
    <script>
        // 初始化时设置权限数据
        if (window.rolePermissions) {
            rolePermissions = window.rolePermissions;
        }
    </script>
}


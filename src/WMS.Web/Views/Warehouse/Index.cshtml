@model List<WMS.Application.DTOs.WarehouseDto>
@{
    ViewData["Title"] = "ä»“åº“ç®¡ç†";
}

<div class="page-container">
    <div class="page-header-section">
        <div class="page-title-wrapper">
            <h2 class="page-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 8px; vertical-align: middle;">
                    <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5M2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                </svg>
                ä»“åº“ç®¡ç†
            </h2>
            <p class="page-subtitle">ç®¡ç†ä»“åº“ã€åº“åŒºå’Œåº“ä½ä¿¡æ¯</p>
        </div>
        <button class="btn-add" onclick="showCreateWarehouse()" data-permission="Warehouse:Add" data-permission-action="hide">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
            </svg>
            æ–°å¢ä»“åº“
        </button>
    </div>

    <div class="warehouse-management-container">
        <!-- å·¦ä¾§æ ‘å½¢ç»“æ„ -->
        <div class="warehouse-tree-panel">
            <div class="tree-header">
                <h3>ä»“åº“åˆ—è¡¨</h3>
            </div>
            <div class="tree-content" id="warehouseTree">
                @if (Model != null && Model.Any())
                {
                    @foreach (var warehouse in Model)
                    {
                        <div class="tree-node warehouse-node" data-id="@warehouse.Id" data-type="warehouse">
                            <div class="tree-node-header" onclick="toggleNode(this)">
                                <span class="tree-node-icon">ğŸ“¦</span>
                                <span class="tree-node-label">@warehouse.Name</span>
                                <span class="tree-node-code">(@warehouse.Code)</span>
                                <span class="tree-node-toggle">â–¼</span>
                            </div>
                            <div class="tree-node-children" style="display: none;">
                                @if (warehouse.Zones != null && warehouse.Zones.Any())
                                {
                                    @foreach (var zone in warehouse.Zones)
                                    {
                                        <div class="tree-node zone-node" data-id="@zone.Id" data-type="zone" data-warehouse-id="@warehouse.Id">
                                            <div class="tree-node-header" onclick="toggleNode(this)">
                                                <span class="tree-node-icon">ğŸ­</span>
                                                <span class="tree-node-label">@zone.Name</span>
                                                <span class="tree-node-code">(@zone.Code)</span>
                                                <span class="tree-node-toggle">â–¼</span>
                                            </div>
                                            <div class="tree-node-children" style="display: none;">
                                                @if (zone.Locations != null && zone.Locations.Any())
                                                {
                                                    @foreach (var location in zone.Locations)
                                                    {
                                                        <div class="tree-node location-node" data-id="@location.Id" data-type="location" data-zone-id="@zone.Id">
                                                            <div class="tree-node-header" onclick="selectNode(this, 'location', @location.Id, @zone.Id)">
                                                                <span class="tree-node-icon">ğŸ“</span>
                                                                <span class="tree-node-label">@location.Name</span>
                                                                <span class="tree-node-code">(@location.Code)</span>
                                                            </div>
                                                        </div>
                                                    }
                                                }
                                                <div class="tree-node-add" onclick="showCreateLocation(@zone.Id)">
                                                    <span class="tree-node-icon">+</span>
                                                    <span>æ·»åŠ åº“ä½</span>
                                                </div>
                                            </div>
                                        </div>
                                    }
                                }
                                <div class="tree-node-add" onclick="showCreateZone(@warehouse.Id)">
                                    <span class="tree-node-icon">+</span>
                                    <span>æ·»åŠ åº“åŒº</span>
                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <div class="tree-empty">
                        <p>æš‚æ— ä»“åº“æ•°æ®</p>
                    </div>
                }
            </div>
        </div>

        <!-- å³ä¾§è¯¦æƒ…/ç¼–è¾‘é¢æ¿ -->
        <div class="warehouse-detail-panel">
            <div id="detailContent" class="detail-content">
                <div class="detail-empty">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16" style="opacity: 0.3; margin-bottom: 1rem;">
                        <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5M2 5h12v9a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                    </svg>
                    <p>è¯·ä»å·¦ä¾§é€‰æ‹©ä»“åº“ã€åº“åŒºæˆ–åº“ä½</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ä»“åº“è¡¨å•æ¨¡æ€æ¡† -->
<div id="warehouseModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="warehouseModalTitle">æ–°å¢ä»“åº“</h3>
            <button class="modal-close" onclick="closeWarehouseModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="warehouseForm">
                <input type="hidden" id="warehouseId" />
                <div class="form-group-modern">
                    <label class="form-label-modern">ä»“åº“ç¼–ç  <span class="text-danger">*</span></label>
                    <input type="text" id="warehouseCode" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">ä»“åº“åç§° <span class="text-danger">*</span></label>
                    <input type="text" id="warehouseName" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">ä»“åº“åœ°å€</label>
                    <input type="text" id="warehouseAddress" class="form-control-modern" />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">è”ç³»äºº</label>
                    <input type="text" id="warehouseContactPerson" class="form-control-modern" />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">è”ç³»ç”µè¯</label>
                    <input type="text" id="warehouseContactPhone" class="form-control-modern" />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">å¤‡æ³¨</label>
                    <textarea id="warehouseRemarks" class="form-control-modern" rows="3"></textarea>
                </div>
                <div class="form-group-modern">
                    <div class="form-check-modern">
                        <input type="checkbox" id="warehouseIsEnabled" class="form-check-input-modern" checked />
                        <label class="form-check-label-modern" for="warehouseIsEnabled">å¯ç”¨</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-save" onclick="saveWarehouse()">ä¿å­˜</button>
            <button class="btn-cancel" onclick="closeWarehouseModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<!-- åº“åŒºè¡¨å•æ¨¡æ€æ¡† -->
<div id="zoneModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="zoneModalTitle">æ–°å¢åº“åŒº</h3>
            <button class="modal-close" onclick="closeZoneModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="zoneForm">
                <input type="hidden" id="zoneId" />
                <input type="hidden" id="zoneWarehouseId" />
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“åŒºç¼–ç  <span class="text-danger">*</span></label>
                    <input type="text" id="zoneCode" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“åŒºåç§° <span class="text-danger">*</span></label>
                    <input type="text" id="zoneName" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“åŒºç±»å‹ <span class="text-danger">*</span></label>
                    <select id="zoneType" class="form-control-modern" required>
                        <option value="0">åŸæ–™åŒº</option>
                        <option value="1">æˆå“åŒº</option>
                        <option value="2">æš‚å­˜åŒº</option>
                        <option value="3">é€€æ–™åŒº</option>
                        <option value="4">ä¸è‰¯å“åŒº</option>
                    </select>
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">å¤‡æ³¨</label>
                    <textarea id="zoneRemarks" class="form-control-modern" rows="3"></textarea>
                </div>
                <div class="form-group-modern">
                    <div class="form-check-modern">
                        <input type="checkbox" id="zoneIsEnabled" class="form-check-input-modern" checked />
                        <label class="form-check-label-modern" for="zoneIsEnabled">å¯ç”¨</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-save" onclick="saveZone()">ä¿å­˜</button>
            <button class="btn-cancel" onclick="closeZoneModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<!-- åº“ä½è¡¨å•æ¨¡æ€æ¡† -->
<div id="locationModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="locationModalTitle">æ–°å¢åº“ä½</h3>
            <button class="modal-close" onclick="closeLocationModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <form id="locationForm">
                <input type="hidden" id="locationId" />
                <input type="hidden" id="locationZoneId" />
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“ä½ç¼–ç  <span class="text-danger">*</span></label>
                    <input type="text" id="locationCode" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“ä½åç§° <span class="text-danger">*</span></label>
                    <input type="text" id="locationName" class="form-control-modern" required />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">åº“ä½å±æ€§ <span class="text-danger">*</span></label>
                    <select id="locationType" class="form-control-modern" required>
                        <option value="0">å›ºå®š</option>
                        <option value="1">éšæœº</option>
                    </select>
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">ä½“ç§¯é™åˆ¶ï¼ˆç«‹æ–¹ç±³ï¼‰</label>
                    <input type="number" id="locationVolumeLimit" class="form-control-modern" step="0.01" />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">é‡é‡é™åˆ¶ï¼ˆåƒå…‹ï¼‰</label>
                    <input type="number" id="locationWeightLimit" class="form-control-modern" step="0.01" />
                </div>
                <div class="form-group-modern">
                    <label class="form-label-modern">å¤‡æ³¨</label>
                    <textarea id="locationRemarks" class="form-control-modern" rows="3"></textarea>
                </div>
                <div class="form-group-modern">
                    <div class="form-check-modern">
                        <input type="checkbox" id="locationIsEnabled" class="form-check-input-modern" checked />
                        <label class="form-check-label-modern" for="locationIsEnabled">å¯ç”¨</label>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button class="btn-save" onclick="saveLocation()">ä¿å­˜</button>
            <button class="btn-cancel" onclick="closeLocationModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script src="~/js/warehouse.js"></script>
<style>
.warehouse-management-container {
    display: flex;
    gap: 1.5rem;
    height: calc(100vh - 200px);
}

.warehouse-tree-panel {
    width: 350px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
}

.tree-header {
    padding: 1rem 1.25rem;
    border-bottom: 1px solid #e5e7eb;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 8px 8px 0 0;
}

.tree-header h3 {
    margin: 0;
    font-size: 1rem;
    font-weight: 600;
}

.tree-content {
    flex: 1;
    overflow-y: auto;
    padding: 0.75rem;
}

.tree-node {
    margin-bottom: 0.25rem;
}

.tree-node-header {
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
    user-select: none;
}

.tree-node-header:hover {
    background-color: #f3f4f6;
}

.tree-node-header.active {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
    border-left: 3px solid #667eea;
}

.tree-node-icon {
    margin-right: 0.5rem;
    font-size: 1rem;
}

.tree-node-label {
    flex: 1;
    font-weight: 500;
    color: #374151;
}

.tree-node-code {
    color: #9ca3af;
    font-size: 0.875rem;
    margin-left: 0.5rem;
}

.tree-node-toggle {
    margin-left: auto;
    color: #9ca3af;
    transition: transform 0.2s;
}

.tree-node.expanded .tree-node-toggle {
    transform: rotate(180deg);
}

.tree-node-children {
    margin-left: 1.5rem;
    margin-top: 0.25rem;
}

.zone-node .tree-node-header {
    padding-left: 1rem;
}

.location-node .tree-node-header {
    padding-left: 1.5rem;
    font-size: 0.875rem;
}

.tree-node-add {
    display: flex;
    align-items: center;
    padding: 0.375rem 0.75rem;
    margin-left: 1.5rem;
    color: #667eea;
    cursor: pointer;
    border-radius: 4px;
    font-size: 0.875rem;
    transition: all 0.2s;
}

.tree-node-add:hover {
    background-color: #f3f4f6;
    color: #764ba2;
}

.tree-empty {
    text-align: center;
    padding: 2rem;
    color: #9ca3af;
}

.warehouse-detail-panel {
    flex: 1;
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    overflow: hidden;
}

.detail-content {
    height: 100%;
    overflow-y: auto;
    padding: 1.5rem;
}

.detail-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #9ca3af;
}

.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    border-radius: 8px;
    width: 90%;
    max-width: 600px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
}

.modal-header {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid #e5e7eb;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #9ca3af;
    cursor: pointer;
    padding: 0;
    width: 2rem;
    height: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    transition: all 0.2s;
}

.modal-close:hover {
    background-color: #f3f4f6;
    color: #374151;
}

.modal-body {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
}

.modal-footer {
    padding: 1rem 1.5rem;
    border-top: 1px solid #e5e7eb;
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}
</style>

